## 2026-02-10 - US-001
- Worked: Scaffolding Vite + TypeScript in a temp folder and syncing to repo root avoided non-empty directory setup failures.
- Pitfall: `bun create vite .` cancelled in a non-empty directory, so direct in-place scaffolding was unreliable.
- Decision: Keep Convex connected at the frontend provider/client layer first, then initialize cloud deployment with `bunx convex dev` when credentials are available.
- Reuse: For future stories, use Bun scripts (`typecheck`, `test`, `build`) as the stable validation baseline before feature-level checks.

## 2026-02-10 - US-002
- Worked: Using a Convex mutation for registration with PBKDF2 + per-user salt handled secure password storage and session creation in one server flow.
- Pitfall: React tests failed after introducing Convex hooks until `App` was rendered under `ConvexProvider`.
- Decision: Keep client calls typed with `makeFunctionReference` for now to avoid blocking on generated API files.
- Reuse: For upcoming auth stories, persist only session tokens in local storage and resolve current user through a token-backed Convex query.

## 2026-02-10 - US-003
- Worked: Adding shared Convex session helpers made register/login/logout flows consistent while keeping token storage client-only.
- Pitfall: Session state can momentarily hydrate as unknown, so redirect logic must wait for `getSessionUser` to resolve before forcing logout.
- Decision: Use one generic login failure message for missing users and bad passwords to avoid credential enumeration.
- Reuse: Treat authenticated UI as a protected view backed by a token query; on token mismatch, clear local storage and send users back to login.

## 2026-02-10 - US-004
- Worked: Introducing an `authAccounts` table with provider + subject keys created a reusable identity boundary while keeping current credentials auth intact.
- Pitfall: Migrating toward provider-linked auth can break existing credential lookups unless login keeps a fallback path for legacy records.
- Decision: Keep social buttons visibly disabled with clear "coming soon" copy so UI promises future OAuth without implying current support.
- Reuse: For future OAuth providers, map provider identity into `authAccounts` first, then issue sessions through the same shared auth/session path.

## 2026-02-10 - US-005
- Worked: A token-gated Convex `createServer` mutation plus `listMyServers` query gave immediate realtime list updates after creation with minimal client state.
- Pitfall: Hook order matters in React; dependent queries must be declared after derived auth state to avoid referencing values before initialization.
- Decision: Scope "my servers" to owner-created servers for this story and defer membership-based listing to the join/leave story.
- Reuse: For future protected features, centralize session-token validation in shared Convex helpers so every query/mutation enforces auth consistently.

## 2026-02-10 - US-006
- Worked: A dedicated `serverMemberships` table plus a combined owner/member server query made join/leave updates appear immediately in one realtime list.
- Pitfall: Free-text server IDs can fail Convex ID validation before business logic, so UI must surface safe join errors clearly.
- Decision: Keep owner membership implicit (via `servers.ownerId`) and block owner leave operations to preserve ownership invariants.
- Reuse: For upcoming channel/message permissions, enforce access with shared auth helpers and membership index lookups in Convex before any mutation logic.

## 2026-02-10 - US-007
- Worked: Adding a dedicated owner-only `deleteServer` mutation and wiring it to the owner row action kept server removal simple and realtime.
- Pitfall: Related data cleanup can be missed; deleting `serverMemberships` before deleting the server avoids orphaned membership records.
- Decision: Define this story's delete behavior as hard-delete for server + memberships (channels/messages are deferred until those tables exist).
- Reuse: For future cascading deletes, implement cleanup in Convex mutations where authorization and relational teardown can be enforced together.

## 2026-02-10 - US-008
- Worked: Modeling channels with a server-scoped uniqueness index and membership-gated Convex queries provided realtime updates without extra client cache logic.
- Pitfall: Channel permissions need explicit rule boundaries; allowing delete only for server owners or channel creators keeps moderation behavior predictable for MVP.
- Decision: Keep channel creation open to any server member while enforcing list/create/delete authorization in Convex.
- Reuse: Drive channel UI from selected server state and let Convex realtime queries handle create/delete refresh automatically.
